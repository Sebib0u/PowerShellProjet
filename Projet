Enter-PSSession -ComputerName SRVSEB -Credential SEB\Administrator #prise en charge du serveur à distance
Import-Module GroupPolicy # Une fois GPMC installé, vous pouvez charger le module de stratégie de groupe.
Get-Command –Module GroupPolicy # Pour obtenir une liste des applets de commande disponibles dans le module.
Get-GPO -All # M'affiche toutes les GPO de mon serveur.
New-GPO # Créer une GPO.

#GPO 1 (général : font d'écran)
    $GPOname = 'Wallpaper'
    New-GPO -Name $GPOname 
        # A change rpour font d'écran. Voir si possibilité de ne pas passer par la table de registre
        Set-GpRegistryValue -Name $GPOname -key "HKEY_CURRENT_USER\Control Panel\Desktop" -ValueName "Wallpaper" -type string -value "C:\Wallpaper\283763.jpg"
        # Permet de linker vers l'OU, a changer le lien "Target"
        New-GPLink -Name $GPOname -Target "ou=general,dc=seb,dc=com" -LinkEnabled Yes
        Gpupdate /force

#GPO 2 (général : Verrouiller le commpte si 3 échecs mdp)
    Import-Module   GroupPolicy
    $numberOfErrors = Read-Host -Prompt "A partir de combien d'erreurs voulez vous bloquer l'utilisateur ? "
    $TimeOfBan = Read-Host -Prompt "Pendant combien de temps (secondes) ? "
    $GPO2name = 'locking'
    New-GPO -Name $GPO2name 
    $LockoutKey = "System\AccountLockoutPolicy"
    Set-GPRegistryValue -Name $GPO2name.DisplayName -Key $LockoutKey -ValueName "LockoutThreshold" -Type DWORD -Value $numberOfErrors
    New-GPLink -Name $GPO2name -Target "ou=general,dc=seb,dc=com" -LinkEnabled Yes
    Set-GPRegistryValue -Name $GPO2name.DisplayName -Key $LockoutKey -ValueName "LockoutDuration" -Type DWORD -Value $TimeOfBan
    Set-GPRegistryValue -Name $GPO2name.DisplayName -Key $LockoutKey -ValueName "ResetLockoutCount" -Type DWORD -Value $TimeOfBan
    Gpupdate /force

#GPO 3 (Installer des logiciels)
    $GPO3name = 'Installer'


#GPO 4 (politique de mdp)¨
import-module GroupPolicy
$GPO3name = 'PolitiqueChange'
New-GPO -Name $GPO3name 
$GPO = Get-GPO -name $GPO3name
New-GPRegistryValue -Name $GPO.DisplayName -key "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" -ValueName "MinimumPasswordLength" -Type DWord -Value 14
New-GPLink -Name $GPO3name -Target "ou=general,dc=seb,dc=com" -LinkEnabled Yes
Gpupdate /force

